/*
 * Copyright (c) 2020  Eric A. Snell
 *
 * This file is part of eAlvaBrainz
 *
 * eAlvaBrainz is free software: you can redistribute it and/or modify it under the terms of the GNU
 * Lesser General Public License as published by the Free Software Foundation, either version 3 of
 *  the License, or (at your option) any later version.
 *
 * eAlvaBrainz is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License along with eAlvaBrainz.
 * If not, see <http://www.gnu.org/licenses/>.
 */

package com.ealva.brainzapp.data

import com.ealva.ealvabrainz.R
import com.ealva.ealvabrainz.brainz.data.Genre
import timber.log.Timber
import kotlin.math.min

interface GenreItem {
  val name: String
  val count: Int
  fun getDisplayName(fetch: (stringRes: Int) -> String): String

  companion object {
    fun make(name: String, count: Int): GenreItem =
      DisplayGenreImpl(name, count, genreToNameMap[name] ?: nameNotInMap(name))
  }
}

/** Convert to a sorted (by count descending), list of [GenreItem], of maximum size 4 */
fun List<Genre>.toGenreItems(): List<GenreItem> {
  val length = size
  return asSequence()
    .sortedByDescending { it.count }
    .take(min(4, length))
    .map { GenreItem.make(it.name, it.count) }
    .toList()
}

fun List<GenreItem>.toDisplayString(fetch: (stringRes: Int) -> String): String {
  if (isEmpty()) return fetch(R.string.none_in_parens)
  return buildString {
    this@toDisplayString.forEachIndexed { index, genre ->
      if (index > 0) append(", ")
      append(genre.getDisplayName(fetch))
    }
  }
}

private class DisplayGenreImpl(
  override val name: String,
  override val count: Int,
  private val nameRes: Int
) : GenreItem {
  override fun getDisplayName(fetch: (stringRes: Int) -> String): String {
    return try {
      if (nameRes != R.string.empty) fetch(nameRes) else name
    } catch (e: Exception) {
      Timber.e("String resource not found for %s", name)
      name
    }
  }
}

private fun nameNotInMap(name: String): Int {
  Timber.e("Nothing in name map for %s", name)
  return R.string.empty
}

internal val Genre.Companion.nameMap: MutableMap<String, Int>
  get() = genreToNameMap.toMutableMap()

private val genreToNameMap = mapOf<String, Int>(
  "acid house" to R.string.genre_acid_house,
  "acid jazz" to R.string.genre_acid_jazz,
  "acid techno" to R.string.genre_acid_techno,
  "acoustic blues" to R.string.genre_acoustic_blues,
  "acoustic rock" to R.string.genre_acoustic_rock,
  "afrobeat" to R.string.genre_afrobeat,
  "alternative_country" to R.string.genre_alternative_country,
  "alternative dance" to R.string.genre_alternative_dance,
  "alternative folk" to R.string.genre_alternative_folk,
  "alternative hip hop" to R.string.genre_alternative_hip_hop,
  "alternative metal" to R.string.genre_alternative_metal,
  "alternative pop" to R.string.genre_alternative_pop,
  "alternative punk" to R.string.genre_alternative_punk,
  "alternative rock" to R.string.genre_alternative_rock,
  "ambient" to R.string.genre_ambient,
  "ambient house" to R.string.genre_ambient_house,
  "ambient techno" to R.string.genre_ambient_techno,
  "americana" to R.string.genre_americana,
  "anarcho-punk" to R.string.genre_anarcho_punk,
  "aor" to R.string.genre_aor,
  "arena rock" to R.string.genre_arena_rock,
  "art rock" to R.string.genre_art_rock,
  "atmospheric black metal" to R.string.genre_atmospheric_black_metal,
  "audiobook" to R.string.genre_audiobook,
  "avant-garde" to R.string.genre_avant_garde,
  "avant-garde jazz" to R.string.genre_avant_garde_jazz,
  "avant-garde metal" to R.string.genre_avant_garde_metal,
  "avant-garde pop" to R.string.genre_avant_garde_pop,
  "bachata" to R.string.genre_bachata,
  "ballad" to R.string.genre_ballad,
  "barbershop" to R.string.genre_barbershop,
  "baroque" to R.string.genre_baroque,
  "bebop" to R.string.genre_bebop,
  "bhangra" to R.string.genre_bhangra,
  "big band" to R.string.genre_big_band,
  "big beat" to R.string.genre_big_beat,
  "black metal" to R.string.genre_black_metal,
  "blackened death metal" to R.string.genre_blackened_death_metal,
  "blackgaze" to R.string.genre_blackgaze,
  "blue-eyed soul" to R.string.genre_blue_eyed_soul,
  "bluegrass" to R.string.genre_bluegrass,
  "blues" to R.string.genre_blues,
  "blues rock" to R.string.genre_blues_rock,
  "bolero" to R.string.genre_bolero,
  "bolero son" to R.string.genre_bolero_son,
  "boom bap" to R.string.genre_boom_bap,
  "bossa nova" to R.string.genre_bossa_nova,
  "breakbeat" to R.string.genre_breakbeat,
  "breakcore" to R.string.genre_breakcore,
  "breaks" to R.string.genre_breaks,
  "britpop" to R.string.genre_britpop,
  "broken beat" to R.string.genre_broken_beat,
  "brutal death metal" to R.string.genre_brutal_death_metal,
  "bubblegum pop" to R.string.genre_bubblegum_pop,
  "cajun" to R.string.genre_cajun,
  "calypso" to R.string.genre_calypso,
  "canterbury scene" to R.string.genre_canterbury_scene,
  "cantopop" to R.string.genre_cantopop,
  "celtic" to R.string.genre_celtic,
  "celtic punk" to R.string.genre_celtic_punk,
  "chamber pop" to R.string.genre_chamber_pop,
  "champeta" to R.string.genre_champeta,
  "chanson" to R.string.genre_chanson,
  "chicago blues" to R.string.genre_chicago_blues,
  "chillout" to R.string.genre_chillout,
  "chiptune" to R.string.genre_chiptune,
  "christian rock" to R.string.genre_christian_rock,
  "christmas music" to R.string.genre_christmas_music,
  "city pop" to R.string.genre_city_pop,
  "classic blues" to R.string.genre_classic_blues,
  "classic country" to R.string.genre_classic_country,
  "classic jazz" to R.string.genre_classic_jazz,
  "classic rock" to R.string.genre_classic_rock,
  "classical" to R.string.genre_classical,
  "club" to R.string.genre_club,
  "comedy" to R.string.genre_comedy,
  "conscious hip hop" to R.string.genre_conscious_hip_hop,
  "contemporary christian" to R.string.genre_contemporary_christian,
  "contemporary classical" to R.string.genre_contemporary_classical,
  "contemporary folk" to R.string.genre_contemporary_folk,
  "contemporary gospel" to R.string.genre_contemporary_gospel,
  "contemporary jazz" to R.string.genre_contemporary_jazz,
  "contemporary r&b" to R.string.genre_contemporary_r_and_b,
  "contra" to R.string.genre_contra,
  "cool jazz" to R.string.genre_cool_jazz,
  "country" to R.string.genre_country,
  "country blues" to R.string.genre_country_blues,
  "country folk" to R.string.genre_country_folk,
  "country pop" to R.string.genre_country_pop,
  "country rock" to R.string.genre_country_rock,
  "crossover prog" to R.string.genre_crossover_prog,
  "crust punk" to R.string.genre_crust_punk,
  "cumbia" to R.string.genre_cumbia,
  "d-beat" to R.string.genre_d_beat,
  "dance" to R.string.genre_dance,
  "dance-pop" to R.string.genre_dance_pop,
  "dance-punk" to R.string.genre_dance_punk,
  "dancehall" to R.string.genre_dancehall,
  "dark ambient" to R.string.genre_dark_ambient,
  "dark electro" to R.string.genre_dark_electro,
  "dark folk" to R.string.genre_dark_folk,
  "dark wave" to R.string.genre_dark_wave,
  "death metal" to R.string.genre_death_metal,
  "death-doom metal" to R.string.genre_death_doom_metal,
  "deathcore" to R.string.genre_deathcore,
  "deathgrind" to R.string.genre_deathgrind,
  "deathrock" to R.string.genre_deathrock,
  "deep house" to R.string.genre_deep_house,
  "delta blues" to R.string.genre_delta_blues,
  "desert rock" to R.string.genre_desert_rock,
  "digital hardcore" to R.string.genre_digital_hardcore,
  "disco" to R.string.genre_disco,
  "doo-wop" to R.string.genre_doo_wop,
  "doom metal" to R.string.genre_doom_metal,
  "downtempo" to R.string.genre_downtempo,
  "drill" to R.string.genre_drill,
  "drone" to R.string.genre_drone,
  "drum and bass" to R.string.genre_drum_and_bass,
  "dub" to R.string.genre_dub,
  "dub techno" to R.string.genre_dub_techno,
  "dubstep" to R.string.genre_dubstep,
  "dungeon synth" to R.string.genre_dungeon_synth,
  "east coast hip hop" to R.string.genre_east_coast_hip_hop,
  "ebm" to R.string.genre_ebm,
  "electric_blues" to R.string.genre_electric_blues,
  "electro" to R.string.genre_electro,
  "electro house" to R.string.genre_electro_house,
  "electro swing" to R.string.genre_electro_swing,
  "electro-funk" to R.string.genre_electro_funk,
  "electro-industrial" to R.string.genre_electro_industrial,
  "electroclash" to R.string.genre_electroclash,
  "electronic" to R.string.genre_electronic,
  "electronic rock" to R.string.genre_electronic_rock,
  "electronica" to R.string.genre_electronica,
  "electronicore" to R.string.genre_electronicore,
  "electropop" to R.string.genre_electropop,
  "electropunk" to R.string.genre_electropunk,
  "emo" to R.string.genre_emo,
  "emocore" to R.string.genre_emocore,
  "enka" to R.string.genre_enka,
  "ethereal" to R.string.genre_ethereal,
  "euro house" to R.string.genre_euro_house,
  "eurodance" to R.string.genre_eurodance,
  "europop" to R.string.genre_europop,
  "experimental" to R.string.genre_experimental,
  "experimental rock" to R.string.genre_experimental_rock,
  "fado" to R.string.genre_fado,
  "filk" to R.string.genre_filk,
  "flamenco" to R.string.genre_flamenco,
  "folk" to R.string.genre_folk,
  "folk metal" to R.string.genre_folk_metal,
  "folk pop" to R.string.genre_folk_pop,
  "folk punk" to R.string.genre_folk_punk,
  "folk rock" to R.string.genre_folk_rock,
  "freak folk" to R.string.genre_freak_folk,
  "free improvisation" to R.string.genre_free_improvisation,
  "free jazz" to R.string.genre_free_jazz,
  "funk" to R.string.genre_funk,
  "funk carioca" to R.string.genre_funk_carioca,
  "funk metal" to R.string.genre_funk_metal,
  "funk rock" to R.string.genre_funk_rock,
  "funk soul" to R.string.genre_funk_soul,
  "funky house" to R.string.genre_funky_house,
  "fusion" to R.string.genre_fusion,
  "future jazz" to R.string.genre_future_jazz,
  "futurepop" to R.string.genre_futurepop,
  "g-funk" to R.string.genre_g_funk,
  "gabber" to R.string.genre_gabber,
  "gangsta rap" to R.string.genre_gangsta_rap,
  "garage" to R.string.genre_garage,
  "garage house" to R.string.genre_garage_house,
  "garage punk" to R.string.genre_garage_punk,
  "garage rock" to R.string.genre_garage_rock,
  "glam" to R.string.genre_glam,
  "glam metal" to R.string.genre_glam_metal,
  "glam rock" to R.string.genre_glam_rock,
  "glitch" to R.string.genre_glitch,
  "goa trance" to R.string.genre_goa_trance,
  "goregrind" to R.string.genre_goregrind,
  "gospel" to R.string.genre_gospel,
  "gothic" to R.string.genre_gothic,
  "gothic metal" to R.string.genre_gothic_metal,
  "gothic rock" to R.string.genre_gothic_rock,
  "grebo" to R.string.genre_grebo,
  "grime" to R.string.genre_grime,
  "grindcore" to R.string.genre_grindcore,
  "groove metal" to R.string.genre_groove_metal,
  "grunge" to R.string.genre_grunge,
  "guaracha" to R.string.genre_guaracha,
  "happy hardcore" to R.string.genre_happy_hardcore,
  "hard bop" to R.string.genre_hard_bop,
  "hard house" to R.string.genre_hard_house,
  "hard rock" to R.string.genre_hard_rock,
  "hard trance" to R.string.genre_hard_trance,
  "hardcore punk" to R.string.genre_hardcore_punk,
  "hardcore techno" to R.string.genre_hardcore_techno,
  "hardstyle" to R.string.genre_hardstyle,
  "heavy metal" to R.string.genre_heavy_metal,
  "hip hop" to R.string.genre_hip_hop,
  "honky tonk" to R.string.genre_honky_tonk,
  "horror punk" to R.string.genre_horror_punk,
  "horrorcore" to R.string.genre_horrorcore,
  "house" to R.string.genre_house,
  "idm" to R.string.genre_idm,
  "illbient" to R.string.genre_illbient,
  "indie" to R.string.genre_indie,
  "indie folk" to R.string.genre_indie_folk,
  "indie pop" to R.string.genre_indie_pop,
  "indie rock" to R.string.genre_indie_rock,
  "indietronica" to R.string.genre_indietronica,
  "indorock" to R.string.genre_indorock,
  "industrial" to R.string.genre_industrial,
  "industrial metal" to R.string.genre_industrial_metal,
  "industrial rock" to R.string.genre_industrial_rock,
  "instrumental" to R.string.genre_instrumental,
  "instrumental jazz" to R.string.genre_instrumental_jazz,
  "instrumental rock" to R.string.genre_instrumental_rock,
  "irish folk" to R.string.genre_irish_folk,
  "italo-disco" to R.string.genre_italo_disco,
  "j-pop" to R.string.genre_j_pop,
  "j-rock" to R.string.genre_j_rock,
  "jazz" to R.string.genre_jazz,
  "jazz blues" to R.string.genre_jazz_blues,
  "jazz fusion" to R.string.genre_jazz_fusion,
  "jazz rap" to R.string.genre_jazz_rap,
  "jazz rock" to R.string.genre_jazz_rock,
  "jazz-funk" to R.string.genre_jazz_funk,
  "jungle" to R.string.genre_jungle,
  "k-pop" to R.string.genre_k_pop,
  "kayōkyoku" to R.string.genre_kayōkyoku,
  "kizomba" to R.string.genre_kizomba,
  "klezmer" to R.string.genre_klezmer,
  "krautrock" to R.string.genre_krautrock,
  "latin" to R.string.genre_latin,
  "latin jazz" to R.string.genre_latin_jazz,
  "latin pop" to R.string.genre_latin_pop,
  "latin rock" to R.string.genre_latin_rock,
  "leftfield" to R.string.genre_leftfield,
  "line dance" to R.string.genre_line_dance,
  "lo-fi" to R.string.genre_lo_fi,
  "lounge" to R.string.genre_lounge,
  "lovers rock" to R.string.genre_lovers_rock,
  "madchester" to R.string.genre_madchester,
  "mainstream rock" to R.string.genre_mainstream_rock,
  "mambo" to R.string.genre_mambo,
  "mandopop" to R.string.genre_mandopop,
  "martial industrial" to R.string.genre_martial_industrial,
  "math rock" to R.string.genre_math_rock,
  "mathcore" to R.string.genre_mathcore,
  "medieval" to R.string.genre_medieval,
  "melodic black metal" to R.string.genre_melodic_black_metal,
  "melodic death metal" to R.string.genre_melodic_death_metal,
  "melodic metalcore" to R.string.genre_melodic_metalcore,
  "melodic rock" to R.string.genre_melodic_rock,
  "melodic trance" to R.string.genre_melodic_trance,
  "mento" to R.string.genre_mento,
  "merengue" to R.string.genre_merengue,
  "metal" to R.string.genre_metal,
  "metalcore" to R.string.genre_metalcore,
  "microhouse" to R.string.genre_microhouse,
  "milonga" to R.string.genre_milonga,
  "min'yō" to R.string.genre_min_yo,
  "mincecore" to R.string.genre_mincecore,
  "minimal" to R.string.genre_minimal,
  "modern blues" to R.string.genre_modern_blues,
  "modern classical" to R.string.genre_modern_classical,
  "modern country" to R.string.genre_modern_country,
  "motown" to R.string.genre_motown,
  "mpb" to R.string.genre_mpb,
  "musical" to R.string.genre_musical,
  "neo soul" to R.string.genre_neo_soul,
  "neo-progressive rock" to R.string.genre_neo_progressive_rock,
  "neo-rockabilly" to R.string.genre_neo_rockabilly,
  "neofolk" to R.string.genre_neofolk,
  "nerdcore" to R.string.genre_nerdcore,
  "new age" to R.string.genre_new_age,
  "new jack swing" to R.string.genre_new_jack_swing,
  "new romantic" to R.string.genre_new_romantic,
  "new wave" to R.string.genre_new_wave,
  "no wave" to R.string.genre_no_wave,
  "noise" to R.string.genre_noise,
  "noise pop" to R.string.genre_noise_pop,
  "noisecore" to R.string.genre_noisecore,
  "non-music" to R.string.genre_non_music,
  "norteño" to R.string.genre_norteño,
  "northern soul" to R.string.genre_northern_soul,
  "nu jazz" to R.string.genre_nu_jazz,
  "nu metal" to R.string.genre_nu_metal,
  "occult rock" to R.string.genre_occult_rock,
  "oi" to R.string.genre_oi,
  "old school death metal" to R.string.genre_old_school_death_metal,
  "old-time" to R.string.genre_old_time,
  "opera" to R.string.genre_opera,
  "orchestral" to R.string.genre_orchestral,
  "outlaw country" to R.string.genre_outlaw_country,
  "p-funk" to R.string.genre_p_funk,
  "pachanga" to R.string.genre_pachanga,
  "pop" to R.string.genre_pop,
  "pop metal" to R.string.genre_pop_metal,
  "pop punk" to R.string.genre_pop_punk,
  "pop rap" to R.string.genre_pop_rap,
  "pop rock" to R.string.genre_pop_rock,
  "pop soul" to R.string.genre_pop_soul,
  "pornogrind" to R.string.genre_pornogrind,
  "post-bop" to R.string.genre_post_bop,
  "post-classical" to R.string.genre_post_classical,
  "post-grunge" to R.string.genre_post_grunge,
  "post-hardcore" to R.string.genre_post_hardcore,
  "post-metal" to R.string.genre_post_metal,
  "post-punk" to R.string.genre_post_punk,
  "post-rock" to R.string.genre_post_rock,
  "power electronics" to R.string.genre_power_electronics,
  "power metal" to R.string.genre_power_metal,
  "power pop" to R.string.genre_power_pop,
  "powerviolence" to R.string.genre_powerviolence,
  "production music" to R.string.genre_production_music,
  "progressive" to R.string.genre_progressive,
  "progressive folk" to R.string.genre_progressive_folk,
  "progressive house" to R.string.genre_progressive_house,
  "progressive metal" to R.string.genre_progressive_metal,
  "progressive rock" to R.string.genre_progressive_rock,
  "progressive trance" to R.string.genre_progressive_trance,
  "psy-trance" to R.string.genre_psy_trance,
  "psychedelic" to R.string.genre_psychedelic,
  "psychedelic folk" to R.string.genre_psychedelic_folk,
  "psychedelic pop" to R.string.genre_psychedelic_pop,
  "psychedelic rock" to R.string.genre_psychedelic_rock,
  "psychobilly" to R.string.genre_psychobilly,
  "psytrance" to R.string.genre_psytrance,
  "punk" to R.string.genre_punk,
  "punk rock" to R.string.genre_punk_rock,
  "queercore" to R.string.genre_queercore,
  "r&b" to R.string.genre_r_and_b,
  "ragga" to R.string.genre_ragga,
  "ragga hip-hop" to R.string.genre_ragga_hip_hop,
  "ragga jungle" to R.string.genre_ragga_jungle,
  "ragtime" to R.string.genre_ragtime,
  "raï" to R.string.genre_raï,
  "ranchera" to R.string.genre_ranchera,
  "rap rock" to R.string.genre_rap_rock,
  "rapcore" to R.string.genre_rapcore,
  "rave" to R.string.genre_rave,
  "reggae" to R.string.genre_reggae,
  "reggaeton" to R.string.genre_reggaeton,
  "rhythmic noise" to R.string.genre_rhythmic_noise,
  "rock" to R.string.genre_rock,
  "rock and roll" to R.string.genre_rock_and_roll,
  "rockabilly" to R.string.genre_rockabilly,
  "rocksteady" to R.string.genre_rocksteady,
  "roots reggae" to R.string.genre_roots_reggae,
  "rumba" to R.string.genre_rumba,
  "salsa" to R.string.genre_salsa,
  "samba" to R.string.genre_samba,
  "schlager" to R.string.genre_schlager,
  "screamo" to R.string.genre_screamo,
  "shibuya-kei" to R.string.genre_shibuya_kei,
  "shoegaze" to R.string.genre_shoegaze,
  "singer-songwriter" to R.string.genre_singer_songwriter,
  "ska" to R.string.genre_ska,
  "ska punk" to R.string.genre_ska_punk,
  "skacore" to R.string.genre_skacore,
  "slow waltz" to R.string.genre_slow_waltz,
  "sludge metal" to R.string.genre_sludge_metal,
  "smooth jazz" to R.string.genre_smooth_jazz,
  "smooth soul" to R.string.genre_smooth_soul,
  "soca" to R.string.genre_soca,
  "soft rock" to R.string.genre_soft_rock,
  "son cubano" to R.string.genre_son_cubano,
  "son montuno" to R.string.genre_son_montuno,
  "soul" to R.string.genre_soul,
  "soul jazz" to R.string.genre_soul_jazz,
  "southern rock" to R.string.genre_southern_rock,
  "southern soul" to R.string.genre_southern_soul,
  "space rock" to R.string.genre_space_rock,
  "speed garage" to R.string.genre_speed_garage,
  "speed metal" to R.string.genre_speed_metal,
  "spoken word" to R.string.genre_spoken_word,
  "stoner metal" to R.string.genre_stoner_metal,
  "stoner rock" to R.string.genre_stoner_rock,
  "street punk" to R.string.genre_street_punk,
  "surf rock" to R.string.genre_surf_rock,
  "swing" to R.string.genre_swing,
  "symphonic black metal" to R.string.genre_symphonic_black_metal,
  "symphonic metal" to R.string.genre_symphonic_metal,
  "symphonic prog" to R.string.genre_symphonic_prog,
  "symphonic rock" to R.string.genre_symphonic_rock,
  "symphony" to R.string.genre_symphony,
  "synth-pop" to R.string.genre_synth_pop,
  "synthwave" to R.string.genre_synthwave,
  "tango" to R.string.genre_tango,
  "tech house" to R.string.genre_tech_house,
  "technical death metal" to R.string.genre_technical_death_metal,
  "techno" to R.string.genre_techno,
  "teen pop" to R.string.genre_teen_pop,
  "thrash metal" to R.string.genre_thrash_metal,
  "thrashcore" to R.string.genre_thrashcore,
  "timba" to R.string.genre_timba,
  "traditional country" to R.string.genre_traditional_country,
  "trance" to R.string.genre_trance,
  "trap" to R.string.genre_trap,
  "trap edm" to R.string.genre_trap_edm,
  "tribal house" to R.string.genre_tribal_house,
  "trip hop" to R.string.genre_trip_hop,
  "turntablism" to R.string.genre_turntablism,
  "uk drill" to R.string.genre_uk_drill,
  "uk garage" to R.string.genre_uk_garage,
  "underground hip hop" to R.string.genre_underground_hip_hop,
  "vallenato" to R.string.genre_vallenato,
  "vaporwave" to R.string.genre_vaporwave,
  "viking metal" to R.string.genre_viking_metal,
  "visual kei" to R.string.genre_visual_kei,
  "vocal house" to R.string.genre_vocal_house,
  "vocal jazz" to R.string.genre_vocal_jazz,
  "vocal trance" to R.string.genre_vocal_trance,
  "west coast hip hop" to R.string.genre_west_coast_hip_hop,
  "west coast swing" to R.string.genre_west_coast_swing,
  "yé-yé" to R.string.genre_yé_yé,
  "zamrock" to R.string.genre_zamrock,
  "zydeco" to R.string.genre_zydeco
)
